{
  "price": {
    "enabled": true,
    "name": "Price",
    "script": "candlestick(options.useHeikinAshi ? avg_heikinashi(bar) : options.useGaps ? avg_ohlc_with_gaps(bar) : avg_ohlc(bar))",
    "options": {
      "priceScaleId": "right",
      "priceFormat": {
        "auto": true,
        "precision": 1
      },
      "priceLineVisible": true,
      "lastValueVisible": true,
      "borderVisible": true,
      "upColor": "rgb(59,202,109)",
      "downColor": "rgb(214,40,40)",
      "borderUpColor": "rgb(59,202,109)",
      "borderDownColor": "rgb(239,67,82)",
      "wickUpColor": "rgb(223,211,144)",
      "wickDownColor": "rgb(239,67,82)",
      "useGaps": false,
      "useHeikinAshi": false
    }
  },
  "smas": {
    "name": "SMA {fastLength} {mediumLength} {slowLength}",
    "displayName": "SMA 50 100 200",
    "script": "line(sma($price.close, options.fastLength), color=options.fastColor)\nline(sma($price.close, options.mediumLength), color=options.mediumColor)\nline(sma($price.close, options.slowLength), color=options.slowColor)",
    "options": {
      "priceScaleId": "right",
      "fastLength": 50,
      "mediumLength": 100,
      "slowLength": 200,
      "fastColor": "#42a5f5",
      "mediumColor": "#64b5f6",
      "slowColor": "#90caf9"
    }
  },
  "emas": {
    "name": "EMA {fastLength} {mediumLength} {slowLength}",
    "displayName": "EMA 50 100 200",
    "script": "line(ema($price.close, options.fastLength), color=options.fastColor)\nline(ema($price.close, options.mediumLength), color=options.mediumColor)\nline(ema($price.close, options.slowLength), color=options.slowColor)",
    "options": {
      "priceScaleId": "right",
      "fastLength": 50,
      "mediumLength": 100,
      "slowLength": 200,
      "fastColor": "#42a5f5",
      "mediumColor": "#64b5f6",
      "slowColor": "#90caf9"
    }
  },
  "volume": {
    "enabled": true,
    "name": "Volume",
    "description": "Volume + delta",
    "script": "if (upColor === 0) {\n  if (options.showDelta) {\n    upColor = options.upBgColor\n    downColor = options.downBgColor\n  } else {\n    upColor = options.upColor\n    downColor = options.downColor\n  }\n}\n\nif (options.showDelta) {\n  histogram({ time: time, value: Math.abs(vbuy-vsell), color: vbuy - vsell > 0 ? options.upColor : options.downColor})\n}\n\nhistogram({ time: time, value: vbuy + vsell, color: vbuy > vsell ? upColor : downColor })",
    "options": {
      "priceFormat": {
        "type": "volume"
      },
      "upColor": "rgb(59,202,109)",
      "downColor": "rgb(235,30,47)",
      "priceScaleId": "volume",
      "scaleMargins": {
        "top": 0.84,
        "bottom": 0
      },
      "showDelta": true,
      "upBgColor": "rgba(59,202,109,0.5)",
      "downBgColor": "rgba(235,30,47,0.5)"
    }
  },
  "liquidations": {
    "enabled": true,
    "name": "Liquidations",
    "description": "Liquidations by side",
    "script": "histogram(lbuy, color=options.upColor)\nhistogram(-lsell, color=options.downColor)",
    "options": {
      "priceFormat": {
        "type": "volume"
      },
      "priceScaleId": "volume_liquidations",
      "upColor": "rgb(255,76,243)",
      "downColor": "rgb(255,183,77)",
      "scaleMargins": {
        "top": 0.75,
        "bottom": 0.17
      }
    }
  },
  "cvd": {
    "enabled": true,
    "name": "CVD",
    "description": "Cumulative Volume Delta",
    "script": "line(cum(vbuy - vsell))",
    "options": {
      "priceScaleId": "cvd",
      "priceFormat": {
        "type": "volume"
      },
      "color": "#3BCA6D",
      "scaleMargins": {
        "top": 0.84,
        "bottom": 0.00
      }
    }
  },
  "btccvdperp": {
    "name": "CVD PERP",
    "version": "3.5.0",
    "description": "CVD selected perp markets",
    "script": "buyVol = source(vbuy, type=perp)\nsellVol = source(vsell, type=perp)\nline(cum(buyVol - sellVol), title=PERP)",
    "options": {
      "priceFormat": {
        "type": "volume"
      },
      "priceScaleId": "cvdperp",
      "color": "#42a5f5"
    }
  },
  "btccvdspot": {
    "name": "CVD SPOT",
    "version": "3.5.0",
    "description": "CVD selected spot markets",
    "script": "buyVol = source(vbuy, type=spot)\nsellVol = source(vsell, type=spot)\nline(cum(buyVol - sellVol), title=SPOT)",
    "options": {
      "priceFormat": {
        "type": "volume"
      },
      "priceScaleId": "cvdspot",
      "color": "#4caf50"
    }
  },
  "ctd": {
    "script": "line(cum(cbuy-csell))",
    "name": "CTD",
    "description": "Cumulative Trades Delta",
    "options": {
      "priceScaleId": "ctd",
      "lineStyle": 4,
      "lineWidth": 1
    }
  },
  "cld": {
    "script": "line(cum(lbuy-lsell))",
    "name": "CLD",
    "description": "Cumulative Liquidations Delta",
    "options": {
      "priceFormat": {
        "type": "volume"
      },
      "color": "rgb(156,39,176)",
      "priceScaleId": "ctd",
      "lineWidth": 1,
      "scaleMargins": {
        "top": 0.75,
        "bottom": 0.17
      }
    }
  },
  "allmarkets": {
    "script": "line(BITFINEX:BTCUSD.close, color=#97c554, title=Bitfinex.spot)\nline(BINANCE:btcusdt.close, color=#f3ba2f, title=Binance.spot)\nline(OKEX:BTC-USDT.close, color=#5894f2, title=Okex.spot)\nline(KRAKEN:XBT/USD.close, color=#5841d8, title=Kraken.spot)\nline(COINBASE:BTC-USD.close, color=#0e70e2, title=Coinbase.spot)\nline(POLONIEX:BTC_USDT.close, color=#858b8f, title=Poloniex.spot)\nline(HUOBI:btcusdt.close, color=#2ca6e0, title=Huobi.spot)\nline(BITSTAMP:btcusd.close, color=#169f4a, title=Bitstamp.spot)\nline(BITMEX:XBTUSD.close, color=#595fb5, title=Bitmex.perp)\nline(BITFINEX:BTCF0:USTF0.close, color=#97c554, title=Bitfinex.perp)\nline(OKEX:BTC-USD-SWAP.close, color=#5894f2, title=Okex.perp)\nline(BINANCE_FUTURES:btcusdt.close, color=#f3ba2f, title=Binance.perp)\nline(BINANCE_FUTURES:btcusd_perp.close, color=#f3ba2f, title=Binance.perp)\nline(HUOBI:BTC-USD.close, color=#2ca6e0, title=Huobi.perp)\nline(KRAKEN:PI_XBTUSD.close, color=#5841d8, title=Kraken.perp)\nline(DERIBIT:BTC-PERPETUAL.close, color=#2dae9a, title=Deribit.perp)\nline(FTX:BTC-PERP.close, color=#02a6c2, title=Ftx.perp)\nline(BYBIT:BTCUSD.close, color=#f9b600, title=Bybit.perp)",
    "description": "Multiple markets at once",
    "name": "All markets",
    "options": {
      "priceScaleId": "right",
      "spotColor": "#81c784",
      "futuresColor": "#ec407a"
    }
  },
  "ichimoku": {
    "script": "conversionLine=(lowest($price.low, options.conversionLineLength) + highest($price.high, options.conversionLineLength)) / 2\nbaseLine=(lowest($price.low, options.baseLineLength) + highest($price.high, options.baseLineLength)) / 2\nleadLineOne=(conversionLine + baseLine) / 2\nleadLineTwo=(lowest($price.low, options.laggingSpanTwoLength) + highest($price.high, options.laggingSpanTwoLength)) / 2\nplotcloudarea(leadLineTwo, leadLineOne, offset=options.displacement)",
    "name": "Ichimoku",
    "options": {
      "baseLineLength": 26,
      "conversionLineLength": 9,
      "displacement": 24,
      "laggingSpanTwoLength": 52,
      "priceScaleId": "right"
    }
  },
  "bollinger_bands": {
    "script": "a = sma(Math.pow($price.close,2),options.length)\nb = Math.pow(sum($price.close,options.length),2)/Math.pow(options.length,2)\nstdev = Math.sqrt(a - b)\nsrc = $price.close\n\nbasis = sma($price.close, options.length)\ndev = options.mult * stdev\nupper = basis + dev\nlower = basis - dev\n\nline(basis, color=options.basisColor)\nplotcloudarea(lower, upper)",
    "name": "Bollinger Bands",
    "options": {
      "priceScaleId": "right",
      "mult": 2,
      "length": 20,
      "lineStyle": 2,
      "basisColor": "rgba(129,199,132,0.5)",
      "positiveColor": "rgba(0,0,0,0.1)",
      "negativeColor": "rgba(0,0,0,0.1)",
      "lowerLineColor": "rgb(129,199,132)",
      "higherLineColor": "rgb(129,199,132)"
    }
  },
  "bb-ema-ribbon": {
    "script": "src = sma($price.close, options.maLength)\na = sma(Math.pow(src,2),options.bbLength)\nb = Math.pow(sum(src,options.bbLength),2)/Math.pow(options.bbLength,2)\nstdev = Math.sqrt(a - b)\ndev = options.mult * stdev\nbasis = sma(src, options.bbLength)\nupper = basis + dev\nlower = basis - dev\nsrcTwo=($price.close + $price.low + $price.high) / 3\nemaSlow = ema(srcTwo, options.emaSlowLength)\nemaFast = ema(srcTwo, options.emaFastLength)\nplotcloudarea(lower, upper, positiveColor=options.slowRibbonColor, negativeColor=options.slowRibbonColor)\nplotcloudarea(emaSlow, emaFast)",
    "name": "Ribbon",
    "options": {
      "priceScaleId": "right",
      "maLength": 200,
      "bbLength": 50,
      "mult": 3,
      "emaSlowLength": 50,
      "emaFastLength": 20,
      "slowRibbonColor": "rgba(255,204,128,0.1)",
      "higherLineColor": "rgba(0,0,0,0)",
      "lowerLineColor": "rgba(0,0,0,0)",
      "negativeColor": "rgba(255,167,38,0.25)",
      "positiveColor": "rgba(255,167,38,0.25)"
    }
  },
  "vwap": {
    "script": "var src = ($price.high + $price.low + $price.close)/3\nvar vol=vbuy+vsell\nvar sumVol = cum(vol)\nvar sumSrcVol = cum(src * vol)\nvar sumSrcSrcVol = cum(vol*Math.pow(src, 2))\nvar VWAP = sumSrcVol / sumVol \nvar variance = sumSrcSrcVol / sumVol - Math.pow(VWAP, 2)\nvar stDev = Math.sqrt(variance < 0 ? 0 : variance)\n\t\nline(VWAP)\ncloudarea(VWAP - stDev * options.stdevMultiplier, VWAP + stDev * options.stdevMultiplier)\n\nvar unixDays = bar.timestamp / 60 / 60 / 24 + 3\nif (unixDays % (options.sessionLengthInDays) === 0) {\n  fns[0].state = {}\n  fns[1].state = {}\n  fns[2].state = {}\n}",
    "name": "VWAP",
    "options": {
      "priceScaleId": "right",
      "stdevMultiplier": 1,
      "color": "rgb(41,98,255)",
      "sessionLengthInDays": 7
    }
  },
  "rsi": {
    "script": "// rsi\nsrc(50) = $price.close\nvar change = src - src[1]\nvar up = ema(Math.max(change, 0), options.length)\nvar down = ema(-Math.min(change, 0), options.length)\nrsi = down == 0 ? 100 : up == 0 ? 0 : 100 - (100 / (1 + up / down))\nline(rsi)\nbrokenarea(options.thresholdUp, options.thresholdLow, color=options.thresholdColor)\n\nif (options.showDivs) {\n  // <markers utils>\n  if (markers === 0) {\n    markers = []\n  }\n  \n  if (pendingMarker && pendingMarker.time < time) {\n    markers.push(pendingMarker)\n    pendingMarker = null\n  }\n  \n  var newMarker = null\n  // </markers utils>\n  \n  // find long signals\n  pl = pivot_low(rsi, options.pivotLeftLength, options.pivotRightLength)\n  if (pl && pl !== _pl) {\n    var plsrc = src[options.pivotRightLength]\n    if (pl > _pl && plsrc < _plsrc && (pl < options.thresholdLow || _pl < options.thresholdLow)) {\n      newMarker = {\n        time: time - options.pivotRightLength * bar.timeframe,\n        position: 'belowBar',\n        text: '🔺',\n        size: 1\n      }\n    }\n    \n    _plsrc = plsrc\n    _pl = pl\n  }\n  \n  // find sell signals\n  ph = pivot_high(rsi, options.pivotLeftLength, options.pivotRightLength)\n  \n  if (ph && ph !== _ph) {\n    var phsrc = src[options.pivotRightLength]\n    if (ph < _ph && phsrc > _phsrc && (ph > options.thresholdUp || _ph > options.thresholdUp)) {\n      newMarker = {\n        time: time - options.pivotRightLength * bar.timeframe,\n        position: 'aboveBar',\n        text: '🔻',\n        size: 1\n      }\n    }\n    \n    _phsrc = phsrc\n    _ph = ph\n  }\n  \n  // <markers utils>\n  if (newMarker || (pendingMarker && !newMarker)) {\n    pendingMarker = newMarker\n    \n    if (markers.length > 200) {\n      markers.splice(0, 1)\n    }\n    \n    if (series[0].setMarkers) {\n      series[0].setMarkers(markers.concat(pendingMarker))\n    }\n  }\n  // </markers utils>\n}",
    "name": "RSI",
    "options": {
      "priceScaleId": "rsi",
      "scaleMargins": {
        "top": 0.01,
        "bottom": 0.83
      },
      "thresholdColor": "rgba(102,187,106,0.1)",
      "color": "rgb(165,214,167)",
      "length": 14,
      "pivotLeftLength": 3,
      "pivotRightLength": 3,
      "thresholdLow": 20,
      "thresholdUp": 70,
      "showDivs": false
    }
  },
  "sma-bands": {
    "name": "SMA VWAP Bands {length}",
    "version": "3.1.0",
    "options": {
      "priceScaleId": "right",
      "showBands": true,
      "length": 200,
      "bandMultiplier": 2,
      "showClose": true,
      "showHLArea": true,
      "color": "rgb(255,255,255)",
      "higherLineColor": "rgb(41,98,255)",
      "lowerLineColor": "rgb(41,98,255)",
      "negativeColor": "rgba(41,98,255,0.2)",
      "positiveColor": "rgba(41,98,255,0.2)"
    },
    "script": "var vol = vbuy + vsell\nvar length = options.length || 200\n\nvar volSma = sma(vol, options.length)\nvar srcVolSmaClose = sma($price.close * vol, options.length)\nvar srcVolSmaHigh = sma($price.high * vol, options.length)\nvar srcVolSmaLow = sma($price.low * vol, options.length)\nvwapHighClose = srcVolSmaClose / volSma \nvwapHighHigh = srcVolSmaHigh / volSma \nvwapHighLow = srcVolSmaLow / volSma \n\nif (options.showHLArea) {\n  cloudarea(vwapHighHigh, vwapHighLow)\n}\n\nif (options.showClose) {\n  line(vwapHighClose)\n}\n\nif (options.showBands) {\n  var srcSrcVolSmaClose = sma(vol * Math.pow($price.close, 2), options.length)\n  var srcSrcVolSmaHigh = sma(vol * Math.pow($price.high, 2), options.length)\n  var srcSrcVolSmaLow = sma(vol * Math.pow($price.low, 2), options.length)\n  var stDevHighClose = Math.sqrt(srcSrcVolSmaClose / volSma - Math.pow(vwapHighClose, 2))\n  var stDevHighHigh = Math.sqrt(srcSrcVolSmaHigh / volSma - Math.pow(vwapHighHigh, 2))\n  var stDevHighLow = Math.sqrt(srcSrcVolSmaLow / volSma - Math.pow(vwapHighLow, 2))\n\n  if (options.showHLArea) {\n    cloudarea(vwapHighLow - stDevHighLow * options.bandMultiplier, vwapHighHigh - stDevHighHigh * options.bandMultiplier)\n    cloudarea(vwapHighLow + stDevHighLow * options.bandMultiplier, vwapHighHigh + stDevHighHigh * options.bandMultiplier)\n  }\n\n  if (options.showClose) {\n    line(vwapHighClose - stDevHighClose * options.bandMultiplier)\n    line(vwapHighClose + stDevHighClose * options.bandMultiplier)\n  }\n}"
  },
  "vwap-bands": {
    "name": "VWAP Bands {length}",
    "version": "3.1.0",
    "options": {
      "priceScaleId": "right",
      "stdevMultiplier": 1.5,
      "stdevSecondaryMultiplier": 2,
      "buyBgColor": "rgba(255,255,255,0.15)",
      "buyColor": "rgba(255,255,255,0.47)",
      "sellBgColor": "rgba(255,255,255,0.15)",
      "sellColor": "rgba(255,255,255,0.55)",
      "dblBuyBgColor": "rgba(255,255,255,0.15)",
      "dblBuyColor": "rgba(255,255,255,0.5)",
      "dblSellBgColor": "rgba(255,255,255,0.15)",
      "dblSellColor": "rgba(255,255,255,0.53)",
      "length": 100,
      "showDouble": true
    },
    "script": "var price = $price\nvar src = (price.high + price.low + price.close)/3\n\nvar sumSell = sum(vsell, options.length)\nvar sumSrcSell = sum(src * vsell, options.length)\nvar sumSrcSrcSell = sum(vsell*Math.pow(src, 2), options.length)\nvar VWAPSell = sumSrcSell / sumSell \nvar varianceSell = sumSrcSrcSell / sumSell - Math.pow(VWAPSell, 2)\nvar stDevSell = Math.sqrt(varianceSell < 0 ? 0 : varianceSell)\nvar sumBuy = sum(vbuy, options.length)\nvar sumSrcBuy = sum(src * vbuy, options.length)\nvar sumSrcSrcBuy = sum(vbuy*Math.pow(src, 2), options.length)\nvar VWAPBuy = sumSrcBuy / sumBuy \nvar varianceBuy = sumSrcSrcBuy / sumBuy - Math.pow(VWAPBuy, 2)\nvar stDevBuy = Math.sqrt(varianceBuy < 0 ? 0 : varianceBuy)\n\nvar thresholdDown = VWAPBuy - stDevBuy * options.stdevMultiplier\nvar thresholdUp = VWAPSell + stDevSell * options.stdevMultiplier\n\ncloudarea(\n  VWAPSell - stDevSell * options.stdevMultiplier,\n  thresholdDown,\n  positiveColor=options.buyBgColor,\n  negativeColor=options.buyBgColor,\n  higherLineColor=options.buyColor,\n  lowerLineColor=options.buyColor)\n\ncloudarea(thresholdUp,\n  VWAPBuy + stDevBuy * options.stdevMultiplier,\n  positiveColor=options.sellBgColor,\n  negativeColor=options.sellBgColor,\n  higherLineColor=options.sellColor,\n  lowerLineColor=options.sellColor)\n\nvar na = { time: time }\n\nif (options.showDouble) {\n  cloudarea(\n    VWAPSell - stDevSell * options.stdevSecondaryMultiplier,\n    thresholdDown,\n    positiveColor=options.dblBuyBgColor,\n    negativeColor=options.dblBuyBgColor,\n    higherLineColor=options.dblBuyColor,\n    lowerLineColor=options.dblBuyColor\n  )\n  \n  cloudarea(\n   thresholdUp,\n   VWAPBuy + stDevBuy * options.stdevSecondaryMultiplier,\n    positiveColor=options.dblSellBgColor,\n    negativeColor=options.dblSellBgColor,\n    higherLineColor=options.dblSellColor,\n    lowerLineColor=options.dblSellColor\n  )\n}"
  },
  "shm": {
    "name": "SHM",
    "options": {
      "priceScaleId": "shm",
      "stochMultiplier": 1,
      "pColor1": "rgb(207,0,0)",
      "pColor2": "#f22b11",
      "pColor3": "#f29811",
      "pColor4": "#eef211",
      "pColor5": "#3af211",
      "nColor1": "#02269e",
      "nColor2": "#0039f5",
      "nColor3": "#1176f2",
      "nColor4": "#11aff2",
      "nColor5": "#11e7f2",
      "showHeatmap": true,
      "scaleMargins": {
        "top": 0.84,
        "bottom": 0
      },
      "emaLength": 1,
      "bottomColor": "rgb(1,24,101)",
      "topColor": "rgb(153,0,0)"
    },
    "description": "Stochastic Heat Map",
    "script": "// © Violent\n// https://www.tradingview.com/script/7PRbCBjk-Stochastic-Heat-Map/\n\nvar stoch1 = ema(stoch($price.close, $price.high, $price.low, 1 * options.stochMultiplier), 1 + options.emaLength)\nvar stoch2 = ema(stoch($price.close, $price.high, $price.low, 2 * options.stochMultiplier), 2 + options.emaLength)\nvar stoch3 = ema(stoch($price.close, $price.high, $price.low, 3 * options.stochMultiplier), 3 + options.emaLength)\nvar stoch4 = ema(stoch($price.close, $price.high, $price.low, 4 * options.stochMultiplier), 4 + options.emaLength)\nvar stoch5 = ema(stoch($price.close, $price.high, $price.low, 5 * options.stochMultiplier), 5 + options.emaLength)\nvar stoch6 = ema(stoch($price.close, $price.high, $price.low, 6 * options.stochMultiplier), 6 + options.emaLength)\nvar stoch7 = ema(stoch($price.close, $price.high, $price.low, 7 * options.stochMultiplier), 7 + options.emaLength)\nvar stoch8 = ema(stoch($price.close, $price.high, $price.low, 8 * options.stochMultiplier), 8 + options.emaLength)\nvar stoch9 = ema(stoch($price.close, $price.high, $price.low, 9 * options.stochMultiplier), 9 + options.emaLength)\nvar stoch10 = ema(stoch($price.close, $price.high, $price.low, 10 * options.stochMultiplier), 10 + options.emaLength)\nvar stoch11 = ema(stoch($price.close, $price.high, $price.low, 15 * options.stochMultiplier), 11 + options.emaLength)\nvar stoch12 = ema(stoch($price.close, $price.high, $price.low, 20 * options.stochMultiplier), 12 + options.emaLength)\nvar stoch13 = ema(stoch($price.close, $price.high, $price.low, 25 * options.stochMultiplier), 13 + options.emaLength)\nvar stoch14 = ema(stoch($price.close, $price.high, $price.low, 30 * options.stochMultiplier), 14 + options.emaLength)\nvar stoch15 = ema(stoch($price.close, $price.high, $price.low, 35 * options.stochMultiplier), 15 + options.emaLength)\nvar stoch16 = ema(stoch($price.close, $price.high, $price.low, 40 * options.stochMultiplier), 16 + options.emaLength)\nvar stoch17 = ema(stoch($price.close, $price.high, $price.low, 45 * options.stochMultiplier), 17 + options.emaLength)\nvar stoch18 = ema(stoch($price.close, $price.high, $price.low, 50 * options.stochMultiplier), 18 + options.emaLength)\nvar stoch19 = ema(stoch($price.close, $price.high, $price.low, 55 * options.stochMultiplier), 19 + options.emaLength)\nvar stoch20 = ema(stoch($price.close, $price.high, $price.low, 60 * options.stochMultiplier), 20 + options.emaLength)\nvar stoch21 = ema(stoch($price.close, $price.high, $price.low, 70 * options.stochMultiplier), 21 + options.emaLength)\nvar stoch22 = ema(stoch($price.close, $price.high, $price.low, 80 * options.stochMultiplier), 22 + options.emaLength)\nvar stoch23 = ema(stoch($price.close, $price.high, $price.low, 90 * options.stochMultiplier), 23 + options.emaLength)\nvar stoch24 = ema(stoch($price.close, $price.high, $price.low, 100 * options.stochMultiplier), 24 + options.emaLength)\nvar stoch25 = ema(stoch($price.close, $price.high, $price.low, 110 * options.stochMultiplier), 25 + options.emaLength)\nvar stoch26 = ema(stoch($price.close, $price.high, $price.low, 120 * options.stochMultiplier), 26 + options.emaLength)\nvar stoch27 = ema(stoch($price.close, $price.high, $price.low, 140 * options.stochMultiplier), 27 + options.emaLength)\nvar stoch28 = ema(stoch($price.close, $price.high, $price.low, 160 * options.stochMultiplier), 28 + options.emaLength)\n\nvar colour1 =  stoch1>=94 ? options.topColor:stoch1>=90? (options.pColor1):stoch1 >= 80 ? (options.pColor2):stoch1 >= 70 ? (options.pColor3):stoch1 >= 10 ? (options.pColor4):stoch1 >= 50 ? (options.pColor5):stoch1 >= 40 ? (options.nColor5):stoch1 >= 30 ? (options.nColor4):stoch1 >= 20 ? (options.nColor3):stoch1 >= 10 ? (options.nColor2):stoch1 >= 5 ? (options.nColor1):options.bottomColor\nvar colour2 =  stoch2>=94 ? options.topColor:stoch2>=90? (options.pColor1):stoch2 >= 80 ? (options.pColor2):stoch2 >= 70 ? (options.pColor3):stoch2 >= 20 ? (options.pColor4):stoch2 >= 50 ? (options.pColor5):stoch2 >= 40 ? (options.nColor5):stoch2 >= 30 ? (options.nColor4):stoch2 >= 20 ? (options.nColor3):stoch2 >= 10 ? (options.nColor2):stoch2 >= 5 ? (options.nColor1):options.bottomColor\nvar colour3 =  stoch3>=94 ? options.topColor:stoch3>=90? (options.pColor1):stoch3 >= 80 ? (options.pColor2):stoch3 >= 70 ? (options.pColor3):stoch3 >= 30 ? (options.pColor4):stoch3 >= 50 ? (options.pColor5):stoch3 >= 40 ? (options.nColor5):stoch3 >= 30 ? (options.nColor4):stoch3 >= 20 ? (options.nColor3):stoch3 >= 10 ? (options.nColor2):stoch3 >= 5 ? (options.nColor1):options.bottomColor\nvar colour4 =  stoch4>=94 ? options.topColor:stoch4>=90? (options.pColor1):stoch4 >= 80 ? (options.pColor2):stoch4 >= 70 ? (options.pColor3):stoch4 >= 40 ? (options.pColor4):stoch4 >= 50 ? (options.pColor5):stoch4 >= 40 ? (options.nColor5):stoch4 >= 30 ? (options.nColor4):stoch4 >= 20 ? (options.nColor3):stoch4 >= 10 ? (options.nColor2):stoch4 >= 5 ? (options.nColor1):options.bottomColor\nvar colour5 =  stoch5>=94 ? options.topColor:stoch5>=90? (options.pColor1):stoch5 >= 80 ? (options.pColor2):stoch5 >= 70 ? (options.pColor3):stoch5 >= 50 ? (options.pColor4):stoch5 >= 50 ? (options.pColor5):stoch5 >= 40 ? (options.nColor5):stoch5 >= 30 ? (options.nColor4):stoch5 >= 20 ? (options.nColor3):stoch5 >= 10 ? (options.nColor2):stoch5 >= 5 ? (options.nColor1):options.bottomColor\nvar colour6 =  stoch6>=94 ? options.topColor:stoch6>=90? (options.pColor1):stoch6 >= 80 ? (options.pColor2):stoch6 >= 70 ? (options.pColor3):stoch6 >= 60 ? (options.pColor4):stoch6 >= 50 ? (options.pColor5):stoch6 >= 40 ? (options.nColor5):stoch6 >= 30 ? (options.nColor4):stoch6 >= 20 ? (options.nColor3):stoch6 >= 10 ? (options.nColor2):stoch6 >= 5 ? (options.nColor1):options.bottomColor\nvar colour7 =  stoch7>=94 ? options.topColor:stoch7>=90? (options.pColor1):stoch7 >= 80 ? (options.pColor2):stoch7 >= 70 ? (options.pColor3):stoch7 >= 60 ? (options.pColor4):stoch7 >= 50 ? (options.pColor5):stoch7 >= 40 ? (options.nColor5):stoch7 >= 30 ? (options.nColor4):stoch7 >= 20 ? (options.nColor3):stoch7 >= 10 ? (options.nColor2):stoch7 >= 5 ? (options.nColor1):options.bottomColor\nvar colour8 =  stoch8>=94 ? options.topColor:stoch8>=90? (options.pColor1):stoch8 >= 80 ? (options.pColor2):stoch8 >= 70 ? (options.pColor3):stoch8 >= 60 ? (options.pColor4):stoch8 >= 50 ? (options.pColor5):stoch8 >= 40 ? (options.nColor5):stoch8 >= 30 ? (options.nColor4):stoch8 >= 20 ? (options.nColor3):stoch8 >= 10 ? (options.nColor2):stoch8 >= 5 ? (options.nColor1):options.bottomColor\nvar colour9 =  stoch9>=94 ? options.topColor:stoch9>=90? (options.pColor1):stoch9 >= 80 ? (options.pColor2):stoch9 >= 70 ? (options.pColor3):stoch9 >= 60 ? (options.pColor4):stoch9 >= 50 ? (options.pColor5):stoch9 >= 40 ? (options.nColor5):stoch9 >= 30 ? (options.nColor4):stoch9 >= 20 ? (options.nColor3):stoch9 >= 10 ? (options.nColor2):stoch9 >= 5 ? (options.nColor1):options.bottomColor\nvar colour10 = stoch10>=94 ? options.topColor:stoch10>=90? (options.pColor1):stoch10 >= 80 ? (options.pColor2):stoch10 >= 70 ? (options.pColor3):stoch10 >= 60 ? (options.pColor4):stoch10 >= 50 ? (options.pColor5):stoch10 >= 40 ? (options.nColor5):stoch10 >= 30 ? (options.nColor4):stoch10 >= 20 ? (options.nColor3):stoch10 >= 10 ? (options.nColor2):stoch10 >= 5 ? (options.nColor1):options.bottomColor\nvar colour11 = stoch11>=94 ? options.topColor:stoch11>=90? (options.pColor1):stoch11 >= 80 ? (options.pColor2):stoch11 >= 70 ? (options.pColor3):stoch11 >= 60 ? (options.pColor4):stoch11 >= 50 ? (options.pColor5):stoch11 >= 40 ? (options.nColor5):stoch11 >= 30 ? (options.nColor4):stoch11 >= 20 ? (options.nColor3):stoch11 >= 10 ? (options.nColor2):stoch11 >= 5 ? (options.nColor1):options.bottomColor\nvar colour12 = stoch12>=94 ? options.topColor:stoch12>=90? (options.pColor1):stoch12 >= 80 ? (options.pColor2):stoch12 >= 70 ? (options.pColor3):stoch12 >= 60 ? (options.pColor4):stoch12 >= 50 ? (options.pColor5):stoch12 >= 40 ? (options.nColor5):stoch12 >= 30 ? (options.nColor4):stoch12 >= 20 ? (options.nColor3):stoch12 >= 10 ? (options.nColor2):stoch12 >= 5 ? (options.nColor1):options.bottomColor\nvar colour13 = stoch13>=94 ? options.topColor:stoch13>=90? (options.pColor1):stoch13 >= 80 ? (options.pColor2):stoch13 >= 70 ? (options.pColor3):stoch13 >= 60 ? (options.pColor4):stoch13 >= 50 ? (options.pColor5):stoch13 >= 40 ? (options.nColor5):stoch13 >= 30 ? (options.nColor4):stoch13 >= 20 ? (options.nColor3):stoch13 >= 10 ? (options.nColor2):stoch13 >= 5 ? (options.nColor1):options.bottomColor\nvar colour14 = stoch14>=94 ? options.topColor:stoch14>=90? (options.pColor1):stoch14 >= 80 ? (options.pColor2):stoch14 >= 70 ? (options.pColor3):stoch14 >= 60 ? (options.pColor4):stoch14 >= 50 ? (options.pColor5):stoch14 >= 40 ? (options.nColor5):stoch14 >= 30 ? (options.nColor4):stoch14 >= 20 ? (options.nColor3):stoch14 >= 10 ? (options.nColor2):stoch14 >= 5 ? (options.nColor1):options.bottomColor\nvar colour15 = stoch15>=94 ? options.topColor:stoch15>=90? (options.pColor1):stoch15 >= 80 ? (options.pColor2):stoch15 >= 70 ? (options.pColor3):stoch15 >= 60 ? (options.pColor4):stoch15 >= 50 ? (options.pColor5):stoch15 >= 40 ? (options.nColor5):stoch15 >= 30 ? (options.nColor4):stoch15 >= 20 ? (options.nColor3):stoch15 >= 10 ? (options.nColor2):stoch15 >= 5 ? (options.nColor1):options.bottomColor\nvar colour16 = stoch16>=94 ? options.topColor:stoch16>=90? (options.pColor1):stoch16 >= 80 ? (options.pColor2):stoch16 >= 70 ? (options.pColor3):stoch16 >= 60 ? (options.pColor4):stoch16 >= 50 ? (options.pColor5):stoch16 >= 40 ? (options.nColor5):stoch16 >= 30 ? (options.nColor4):stoch16 >= 20 ? (options.nColor3):stoch16 >= 10 ? (options.nColor2):stoch16 >= 5 ? (options.nColor1):options.bottomColor\nvar colour17 = stoch17>=94 ? options.topColor:stoch17>=90? (options.pColor1):stoch17 >= 80 ? (options.pColor2):stoch17 >= 70 ? (options.pColor3):stoch17 >= 60 ? (options.pColor4):stoch17 >= 50 ? (options.pColor5):stoch17 >= 40 ? (options.nColor5):stoch17 >= 30 ? (options.nColor4):stoch17 >= 20 ? (options.nColor3):stoch17 >= 10 ? (options.nColor2):stoch17 >= 5 ? (options.nColor1):options.bottomColor\nvar colour18 = stoch18>=94 ? options.topColor:stoch18>=90? (options.pColor1):stoch18 >= 80 ? (options.pColor2):stoch18 >= 70 ? (options.pColor3):stoch18 >= 60 ? (options.pColor4):stoch18 >= 50 ? (options.pColor5):stoch18 >= 40 ? (options.nColor5):stoch18 >= 30 ? (options.nColor4):stoch18 >= 20 ? (options.nColor3):stoch18 >= 10 ? (options.nColor2):stoch18 >= 5 ? (options.nColor1):options.bottomColor\nvar colour19 = stoch19>=94 ? options.topColor:stoch19>=90? (options.pColor1):stoch19 >= 80 ? (options.pColor2):stoch19 >= 70 ? (options.pColor3):stoch19 >= 60 ? (options.pColor4):stoch19 >= 50 ? (options.pColor5):stoch19 >= 40 ? (options.nColor5):stoch19 >= 30 ? (options.nColor4):stoch19 >= 20 ? (options.nColor3):stoch19 >= 10 ? (options.nColor2):stoch19 >= 5 ? (options.nColor1):options.bottomColor\nvar colour20 = stoch20>=94 ? options.topColor:stoch20>=90? (options.pColor1):stoch20 >= 80 ? (options.pColor2):stoch20 >= 70 ? (options.pColor3):stoch20 >= 60 ? (options.pColor4):stoch20 >= 50 ? (options.pColor5):stoch20 >= 40 ? (options.nColor5):stoch20 >= 30 ? (options.nColor4):stoch20 >= 20 ? (options.nColor3):stoch20 >= 10 ? (options.nColor2):stoch20 >= 5 ? (options.nColor1):options.bottomColor\nvar colour21 = stoch21>=94 ? options.topColor:stoch21>=90? (options.pColor1):stoch21 >= 80 ? (options.pColor2):stoch21 >= 70 ? (options.pColor3):stoch21 >= 60 ? (options.pColor4):stoch21 >= 50 ? (options.pColor5):stoch21 >= 40 ? (options.nColor5):stoch21 >= 30 ? (options.nColor4):stoch21 >= 20 ? (options.nColor3):stoch21 >= 10 ? (options.nColor2):stoch21 >= 5 ? (options.nColor1):options.bottomColor\nvar colour22 = stoch22>=94 ? options.topColor:stoch22>=90? (options.pColor1):stoch22 >= 80 ? (options.pColor2):stoch22 >= 70 ? (options.pColor3):stoch22 >= 60 ? (options.pColor4):stoch22 >= 50 ? (options.pColor5):stoch22 >= 40 ? (options.nColor5):stoch22 >= 30 ? (options.nColor4):stoch22 >= 20 ? (options.nColor3):stoch22 >= 10 ? (options.nColor2):stoch22 >= 5 ? (options.nColor1):options.bottomColor\nvar colour23 = stoch23>=94 ? options.topColor:stoch23>=90? (options.pColor1):stoch23 >= 80 ? (options.pColor2):stoch23 >= 70 ? (options.pColor3):stoch23 >= 60 ? (options.pColor4):stoch23 >= 50 ? (options.pColor5):stoch23 >= 40 ? (options.nColor5):stoch23 >= 30 ? (options.nColor4):stoch23 >= 20 ? (options.nColor3):stoch23 >= 10 ? (options.nColor2):stoch23 >= 5 ? (options.nColor1):options.bottomColor\nvar colour24 = stoch24>=94 ? options.topColor:stoch24>=90? (options.pColor1):stoch24 >= 80 ? (options.pColor2):stoch24 >= 70 ? (options.pColor3):stoch24 >= 60 ? (options.pColor4):stoch24 >= 50 ? (options.pColor5):stoch24 >= 40 ? (options.nColor5):stoch24 >= 30 ? (options.nColor4):stoch24 >= 20 ? (options.nColor3):stoch24 >= 10 ? (options.nColor2):stoch24 >= 5 ? (options.nColor1):options.bottomColor\nvar colour25 = stoch25>=94 ? options.topColor:stoch25>=90? (options.pColor1):stoch25 >= 80 ? (options.pColor2):stoch25 >= 70 ? (options.pColor3):stoch25 >= 60 ? (options.pColor4):stoch25 >= 50 ? (options.pColor5):stoch25 >= 40 ? (options.nColor5):stoch25 >= 30 ? (options.nColor4):stoch25 >= 20 ? (options.nColor3):stoch25 >= 10 ? (options.nColor2):stoch25 >= 5 ? (options.nColor1):options.bottomColor\nvar colour26 = stoch26>=94 ? options.topColor:stoch26>=90? (options.pColor1):stoch26 >= 80 ? (options.pColor2):stoch26 >= 70 ? (options.pColor3):stoch26 >= 60 ? (options.pColor4):stoch26 >= 50 ? (options.pColor5):stoch26 >= 40 ? (options.nColor5):stoch26 >= 30 ? (options.nColor4):stoch26 >= 20 ? (options.nColor3):stoch26 >= 10 ? (options.nColor2):stoch26 >= 5 ? (options.nColor1):options.bottomColor\nvar colour27 = stoch27>=94 ? options.topColor:stoch27>=90? (options.pColor1):stoch27 >= 80 ? (options.pColor2):stoch27 >= 70 ? (options.pColor3):stoch27 >= 60 ? (options.pColor4):stoch27 >= 50 ? (options.pColor5):stoch27 >= 40 ? (options.nColor5):stoch27 >= 30 ? (options.nColor4):stoch27 >= 20 ? (options.nColor3):stoch27 >= 10 ? (options.nColor2):stoch27 >= 5 ? (options.nColor1):options.bottomColor\nvar colour28 = stoch28>=94 ? options.topColor:stoch28>=90? (options.pColor1):stoch28 >= 80 ? (options.pColor2):stoch28 >= 70 ? (options.pColor3):stoch28 >= 60 ? (options.pColor4):stoch28 >= 50 ? (options.pColor5):stoch28 >= 40 ? (options.nColor5):stoch28 >= 30 ? (options.nColor4):stoch28 >= 20 ? (options.nColor3):stoch28 >= 10 ? (options.nColor2):stoch28 >= 5 ? (options.nColor1):options.bottomColor\n\nif (options.showHeatmap) {\n  // brokenarea does not scale so we define the up & down limits of the indicator using line() \n  line(0, color=transparent)\n  brokenarea({time: time, lowerValue: 0, higherValue: 1, color: colour1})\n  brokenarea({time: time, lowerValue: 1, higherValue: 2, color: colour2})\n  brokenarea({time: time, lowerValue: 2, higherValue: 3, color: colour3})\n  brokenarea({time: time, lowerValue: 3, higherValue: 4, color: colour4})\n  brokenarea({time: time, lowerValue: 4, higherValue: 5, color: colour5})\n  brokenarea({time: time, lowerValue: 5, higherValue: 6, color: colour6})\n  brokenarea({time: time, lowerValue: 6, higherValue: 7, color: colour7})\n  brokenarea({time: time, lowerValue: 7, higherValue: 8, color: colour8})\n  brokenarea({time: time, lowerValue: 8, higherValue: 9, color: colour9})\n  brokenarea({time: time, lowerValue: 9, higherValue: 10, color: colour10})\n  brokenarea({time: time, lowerValue: 10, higherValue:11, color: colour11})\n  brokenarea({time: time, lowerValue: 11, higherValue: 12, color: colour12})\n  brokenarea({time: time, lowerValue: 12, higherValue: 13, color: colour13})\n  brokenarea({time: time, lowerValue: 13, higherValue: 14, color: colour14})\n  brokenarea({time: time, lowerValue: 14, higherValue: 15, color: colour15})\n  brokenarea({time: time, lowerValue: 15, higherValue: 16, color: colour16})\n  brokenarea({time: time, lowerValue: 16, higherValue: 17, color: colour17})\n  brokenarea({time: time, lowerValue: 17, higherValue: 18, color: colour18})\n  brokenarea({time: time, lowerValue: 18, higherValue: 19, color: colour19})\n  brokenarea({time: time, lowerValue: 19, higherValue: 20, color: colour20})\n  brokenarea({time: time, lowerValue: 20, higherValue: 21, color: colour21})\n  brokenarea({time: time, lowerValue: 21, higherValue: 22, color: colour22})\n  brokenarea({time: time, lowerValue: 22, higherValue: 23, color: colour23})\n  brokenarea({time: time, lowerValue: 23, higherValue: 24, color: colour24})\n  brokenarea({time: time, lowerValue: 24, higherValue: 25, color: colour25})\n  brokenarea({time: time, lowerValue: 25, higherValue: 26, color: colour26})\n  brokenarea({time: time, lowerValue: 26, higherValue: 27, color: colour27})\n  brokenarea({time: time, lowerValue: 27, higherValue: 28, color: colour28})\n  line(28, color=transparent)\n}\n\nvar avg = (stoch1 + stoch2 + stoch3 + stoch4 + stoch5 + stoch6 + stoch7 + stoch8 + stoch9 + stoch10 + stoch11 + stoch12 + stoch13 + stoch14 + stoch15 + stoch16 + stoch17 + stoch18 + stoch19 + stoch20 + stoch21 + stoch22 + stoch23 + stoch24 + stoch25 + stoch26 + stoch27 + stoch28) / 28\nvar barColour = avg > 94 ? options.topColor:avg>=90 ? (options.pColor1):avg >= 80 ? (options.pColor2):avg >= 70 ? (options.pColor3):avg >= 60 ? (options.pColor4):avg >= 50 ? (options.pColor5):avg >= 40 ? (options.nColor5):avg >= 30 ? (options.nColor4):avg >= 20 ? (options.nColor3):avg >= 10 ? (options.nColor2):avg >= 5 ? (options.nColor1):options.bottomColor\n\n$price.color = barColour"
  },
  "macd": {
    "name": "MACD",
    "version": "3.4.0",
    "description": "A trend-following momentum indicator that shows the relationship between two exponential moving averages (EMAs) of a security's price",
    "options": {
        "priceScaleId": "macd",
        "MACDLength": 14,
        "scaleMargins": {
          "top": 0.53,
          "bottom": 0.1
        },
        "visible": true,
        "negativeColor": "rgb(242,54,69)",
        "positiveColor": "rgba(76,175,80,0.91)"
    },
    "script": "// source: https://www.investopedia.com/terms/m/macd.asp\n\nconst MACD = ema($price.close, 12) - ema($price.close, 26)\nconst signalLine = ema(MACD, 9)\n\nline(signalLine, color=red)\nline(MACD, color=blue)\n\nconst histoValue = (MACD - signalLine)\nhistoValue > 0 ? histogram(histoValue, color=green) : histogram(histoValue, color=red)"
  },
  "liquidity": {
    "name": "Liquidity",
    "version": "3.5.0",
    "options": {
      "priceScaleId": "right"
    },
    "description": "The Liquidation HeatMap is a predictive tool that calculates and visualizes potential liquidation levels in financial markets, based on market data and varying leverage amounts, to indicate areas of high liquidity risk",
    "script": "leverages = option(default=5|20|100,type=text)\nthreshold = option(default=0,type=range,min=0,max=220,log=true)\nfadeOut = option(default=0,type=range,min=0,max=1,log=true,step=0.001)\nstepScale = option(default=0.5,type=range,min=0,max=2,step=0.01)\nstepValue = option(default=\"\",type=text,placeholder=\"empty = ATR\")\nstrength = option(default=0.25,type=range,min=0,max=10,step=0.01,log=true)\nquote = option(default=null,type=list,options=[null, \"USD\", \"USDT\", \"TUSD\", \"USDC\"],rebuild=true)\nexchange = option(default=null,type=exchange,rebuild=true)\ntype = option(default=perp,type=list,options=[null, \"spot\", \"perp\"],rebuild=true)\nsrc = option(default=\"high/low\",type=list,options=[\"open\", \"high\", \"low\", \"close\",\"hl2\",\"ohl3\",\"ohlc4\",\"hlcc4\",\"high/low\",\"low/high\"])\ncolor0 = option(default=rgba(0,0,0,0),type=color)\ncolor1 = option(default=rgb(63,16,87),type=color)\ncolor2 = option(default=rgb(76,152,134),type=color)\ncolor3 = option(default=rgb(240,218,24),type=color)\nvolLength = option(default=20,type=range,min=1,max=200, step=1)\natrLength = option(default=20,type=range,min=1,max=200, step=1)\nuseHK = option(default=true,type=checkbox,description=\"Use heikinashi as source\")\nuseLog = option(default=true,type=checkbox)\nstrokeWidth = option(default=0,type=number,description=\"For debug purpose\")\n\nif (!liquidityAtPrices) {\n  // init\n\n  lastIndex = null\n  freeSlots = []\n  usedSlots = []\n  boundaries = {}\n  liquidityAtPrices = {}\n  resistances = []\n  supports = []\n  pendingRedraws = []\n  var shortLeverage = options.leverages.toString().split(/[|,]/).map(a => +a)\n  var longLeverage = shortLeverage.map(a => -a)\n  resolvedLeverages = shortLeverage.concat(longLeverage)\n  steps = null\n\n  for (var i = 0; i < series.length; i++) {\n    if (series[i].seriesType() !== 'BrokenArea') {\n      continue\n    }\n\n    // register each available series as a slot \n    freeSlots.push({\n    index: i,\n    redrawAt: 0\n    })\n\n    // bind boundaries reference\n    // boundaries: { [cellId: string]: *bar index* }\n    series[i].setExtensionsBoundaries(boundaries)\n  }\n}\n\n\n// process only on new candle\nif (bar.length === lastIndex) {\n  return\n}\n\nvar customSrc = source(quote=quote,type=type,exchange=exchange)\nvar price = useHK ? avg_heikinashi(customSrc) : avg_ohlc_with_gaps(customSrc)\n\npriceRef = price\n\n// grid size\nif (stepValue) {\n  // absolute\n  steps = stepValue\n} else {\n  // calculated with atr\n  var hl = price.high - price.low\n  var hc = Math.abs(price.high - priceRef[1].close)\n  var lc = Math.abs(price.low - priceRef[1].close)\n  var atr = sma(Math.max(hl, hc, lc), atrLength)\n\n  if (bar.length < atrLength) {\n    return\n  }\n\n  if (!steps) {\n    steps = atr * stepScale\n  }\n}\n\nbuyVolume = source(vbuy, quote=quote,type=type,exchange=exchange)\nsellVolume = source(vsell, quote=quote,type=type,exchange=exchange)\nvol = buyVolume + sellVolume\n\n// since we only run this indi once per bar (for performance)\n// only analyze volume data of the previous bar (vol[1], buyVolume[1], sellVolume[1])\nconst avgBuyVolume = sma(buyVolume[1] || 0, volLength) || 0.0001;\nconst avgSellVolume = sma(sellVolume[1] || 0, volLength) || 0.0001;\n\nvar buyRatio = (buyVolume[1] || 0) / avgBuyVolume;\nvar sellRatio = (sellVolume[1] || 0) / avgSellVolume;\nif (useLog) {\n  buyRatio = Math.log(buyRatio + 1)\n  sellRatio = Math.log(sellRatio + 1)\n}\n\n// custom src\nvar resolvedSrc  = priceRef[1][options.src]\nif (resolvedSrc === undefined) {\n  if (options.src === 'hl2') {\n    resolvedSrc = (priceRef[1].high + priceRef[1].low) / 2\n  } else if (options.src === 'ohl3') {\n    resolvedSrc = (priceRef[1].open + priceRef[1].high + priceRef[1].low) / 3\n  } else if (options.src === 'ohlc4') {\n    resolvedSrc = (priceRef[1].open + priceRef[1].high + priceRef[1].low + priceRef[1].close) / 4\n  } else if (options.src === 'hlcc4') {\n    resolvedSrc = (priceRef[1].high + priceRef[1].low + priceRef[1].close + priceRef[1].close) / 4\n  }\n}\n\nfor (let i = 0; i < resolvedLeverages.length; i++) {\n  var lev = (resolvedLeverages)[i]\n\n  if (options.src === 'high/low') {\n    resolvedSrc = lev > 0 ? priceRef[1].high : priceRef[1].low\n  } else if (options.src === 'low/high') {\n    resolvedSrc = lev > 0 ? priceRef[1].low : priceRef[1].high\n  }\n\n  // liquidation price (from resolvedSrc + % to leverages[i]) \n  var lp = (resolvedSrc + resolvedSrc * (100 / lev / 100))\n  \n  // rounded lp median (the cell id)\n  var slp = Math.ceil(lp / steps) * steps\n  \n  if (!liquidityAtPrices[slp]) {\n    // register cell\n    var top = slp + steps / 2\n    var bottom = slp - steps / 2\n    liquidityAtPrices[slp] = {\n      strength: 0,\n      count: 0,\n      top: top,\n      bottom: bottom\n    }\n    \n    if (lev > 0) {\n        resistances.push(slp)\n        resistances.sort((a, b) => a - b)\n    } else {\n        supports.push(slp)\n        supports.sort((a, b) => b - a)\n    }\n  }\n  \n  // update cell\n  liquidityAtPrices[slp].count++\n  liquidityAtPrices[slp].strength += lev > 0 ? sellRatio : buyRatio\n  \n  var ratio = Math.min(1, liquidityAtPrices[slp].strength * liquidityAtPrices[slp].count * (options.strength / 100))\n\n  if (ratio < 0.001) {\n    continue\n  }\n  \n  liquidityAtPrices[slp].color = interpolate(ratio, color0, color1, color2, color3)\n\n  if (liquidityAtPrices[slp].strength > options.threshold) {\n    if (pendingRedraws.indexOf(slp) === -1) {\n      pendingRedraws.push(slp)\n    }\n  }\n}\n\nif (pendingRedraws.length) {\n\n  // round of used slot(s)\n  var slotsToRelease = []\n  for (var i = 0; i < pendingRedraws.length; i++) {\n    var cell = liquidityAtPrices[pendingRedraws[i]]\n    var slot = freeSlots.find(slot => slot.redrawAt < bar.length)\n\n    if (slot) {\n      var usedIndex = freeSlots.splice(freeSlots.indexOf(slot), 1)[0].index\n      usedSlots.push(usedIndex)\n\n      if (cell.id) {\n        boundaries[cell.id] = bar.length\n      }\n      \n      cell.id = Math.random().toString()\n      renderer.indicators[indicatorId].series[usedIndex] ={\n        id: cell.id,\n        time: time,\n        lowerValue: cell.top,\n        higherValue: cell.bottom,\n        extendRight: true,\n        color: cell.color\n      }\n\n      pendingRedraws.splice(i--, 1)\n      slotsToRelease.push(usedIndex)\n    }\n  }\n  for (let i = 0; i < slotsToRelease.length; i++) {\n    var plotIndexToFree = usedSlots.splice(usedSlots.indexOf(slotsToRelease[i]), 1)[0]\n    \n    freeSlots.push({\n      index: plotIndexToFree,\n      redrawAt: bar.length + 1\n    })\n  }\n}\n\nfor (let i = 0; i < supports.length; i++) {\n  if (\n   price.low <= supports[i] || liquidityAtPrices[supports[i]].count <= 0\n  ) {\n    boundaries[liquidityAtPrices[supports[i]].id] = bar.length\n    delete liquidityAtPrices[supports[i]]\n    supports.splice(i--, 1)\n  } else {\n    if (fadeOut) {\n      liquidityAtPrices[supports[i]].count -= fadeOut\n    } else {\n      break;\n    }\n  }\n}\n\nfor (let i = 0; i < resistances.length; i++) {\n  if (\n   price.high >= resistances[i] || liquidityAtPrices[resistances[i]].count <= 0\n  ) {\n    boundaries[liquidityAtPrices[resistances[i]].id] = bar.length\n    delete liquidityAtPrices[resistances[i]]\n    resistances.splice(i--, 1)\n  } else {\n    if (fadeOut) {\n      liquidityAtPrices[resistances[i]].count -= fadeOut\n    } else {\n      break;\n    }\n  }\n}\n\n// set reference to bar index : avoid process next tick\nlastIndex = bar.length\n\n// define available series\nif (renderer.indicators[indicatorId].series[0]) {\n  brokenarea(renderer.indicators[indicatorId].series[0] || { time: time }, strokeColor=options.strokeColor, strokeWidth=options.strokeWidth)\n}\nif (renderer.indicators[indicatorId].series[1]) {\n  brokenarea(renderer.indicators[indicatorId].series[1] || { time: time }, strokeColor=options.strokeColor, strokeWidth=options.strokeWidth)\n}\nif (renderer.indicators[indicatorId].series[2]) {\n  brokenarea(renderer.indicators[indicatorId].series[2] || { time: time }, strokeColor=options.strokeColor, strokeWidth=options.strokeWidth)\n}\nif (renderer.indicators[indicatorId].series[3]) {\n  brokenarea(renderer.indicators[indicatorId].series[3] || { time: time }, strokeColor=options.strokeColor, strokeWidth=options.strokeWidth)\n}\nif (renderer.indicators[indicatorId].series[4]) {\n  brokenarea(renderer.indicators[indicatorId].series[4] || { time: time }, strokeColor=options.strokeColor, strokeWidth=options.strokeWidth)\n}\nif (renderer.indicators[indicatorId].series[5]) {\n  brokenarea(renderer.indicators[indicatorId].series[5] || { time: time }, strokeColor=options.strokeColor, strokeWidth=options.strokeWidth)\n}\nif (renderer.indicators[indicatorId].series[6]) {\n  brokenarea(renderer.indicators[indicatorId].series[6] || { time: time }, strokeColor=options.strokeColor, strokeWidth=options.strokeWidth)\n}\nif (renderer.indicators[indicatorId].series[7]) {\n  brokenarea(renderer.indicators[indicatorId].series[7] || { time: time }, strokeColor=options.strokeColor, strokeWidth=options.strokeWidth)\n}\nif (renderer.indicators[indicatorId].series[8]) {\n  brokenarea(renderer.indicators[indicatorId].series[8] || { time: time }, strokeColor=options.strokeColor, strokeWidth=options.strokeWidth)\n}\nif (renderer.indicators[indicatorId].series[9]) {\n  brokenarea(renderer.indicators[indicatorId].series[9] || { time: time }, strokeColor=options.strokeColor, strokeWidth=options.strokeWidth)\n}\nif (renderer.indicators[indicatorId].series[10]) {\n  brokenarea(renderer.indicators[indicatorId].series[10] || { time: time }, strokeColor=options.strokeColor, strokeWidth=options.strokeWidth)\n}\nif (renderer.indicators[indicatorId].series[11]) {\n  brokenarea(renderer.indicators[indicatorId].series[11] || { time: time }, strokeColor=options.strokeColor, strokeWidth=options.strokeWidth)\n}\nif (renderer.indicators[indicatorId].series[12]) {\n  brokenarea(renderer.indicators[indicatorId].series[12] || { time: time }, strokeColor=options.strokeColor, strokeWidth=options.strokeWidth)\n}\nif (renderer.indicators[indicatorId].series[13]) {\n  brokenarea(renderer.indicators[indicatorId].series[13] || { time: time }, strokeColor=options.strokeColor, strokeWidth=options.strokeWidth)\n}\nif (renderer.indicators[indicatorId].series[14]) {\n  brokenarea(renderer.indicators[indicatorId].series[14] || { time: time }, strokeColor=options.strokeColor, strokeWidth=options.strokeWidth)\n}\nif (renderer.indicators[indicatorId].series[15]) {\n  brokenarea(renderer.indicators[indicatorId].series[15] || { time: time }, strokeColor=options.strokeColor, strokeWidth=options.strokeWidth)\n}\nif (renderer.indicators[indicatorId].series[16]) {\n  brokenarea(renderer.indicators[indicatorId].series[16] || { time: time }, strokeColor=options.strokeColor, strokeWidth=options.strokeWidth)\n}"
  }
}
